<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpinShot Mx | Promociones Especiales</title>
    
    <meta name="description" content="Descubre las ofertas y paquetes especiales de SpinShot Mx para cabina de fotos 360 y espejo mágico. ¡Promociones por tiempo limitado!">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #F3F4F6;
        }
        .accent-color { 
            color: #EF4444;
        }
        .bg-accent { 
            background-color: #EF4444;
        }
        .border-accent {
            border-color: #EF4444;
        }
        .promo-card {
            background-color: #111111;
            border: 1px solid #222222;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .promo-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 25px rgba(239, 68, 68, 0.3);
        }
        .promo-tag {
            background: linear-gradient(90deg, #EF4444 0%, #991B1B 100%);
        }
        .price-tag {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px dashed #EF4444;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center my-12">
            <h1 class="text-4xl md:text-6xl font-black mb-3 uppercase tracking-wider">
                <span class="accent-color">Promociones</span> Exclusivas
            </h1>
            <p class="text-lg text-gray-400 max-w-2xl mx-auto">
                Aprovecha nuestras ofertas por tiempo limitado y haz que tu evento sea legendario.
            </p>
        </header>

        <!-- Contenedor donde se cargarán las promociones dinámicamente -->
        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
            <!-- Las promociones se insertarán aquí mediante JavaScript -->
        </main>

        <footer class="text-center pb-8">
            <a href="calculadora.html" class="text-gray-400 hover:text-white transition-colors duration-300 border-b border-gray-600 hover:border-accent pb-1">
                &larr; Volver a la Calculadora
            </a>
        </footer>
    </div>

    <!-- Script para cargar promociones dinámicas -->
    <script>
      async function loadPromotions() {
        const container = document.querySelector("main");
        container.innerHTML = "";

        // Obtener lista de archivos en la carpeta promociones
        const response = await fetch("/promociones");
        const text = await response.text();

        // Buscar archivos .md
        const regex = /href="([^"]+\.md)"/g;
        let match;
        const fileLinks = [];
        while ((match = regex.exec(text)) !== null) {
          fileLinks.push(match[1]);
        }

        // Leer cada archivo y renderizar tarjeta
        for (let file of fileLinks) {
          const content = await fetch(file).then(r => r.text());
          const data = parseFrontMatter(content);

          const card = `
            <div class="promo-card rounded-xl overflow-hidden flex flex-col">
                <img src="${data.image}" alt="${data.title}" class="w-full h-48 object-cover">
                <div class="p-6 flex-grow flex flex-col">
                    <div class="promo-tag inline-block text-white text-sm font-bold px-3 py-1 rounded-full mb-4 uppercase self-start">${data.tag}</div>
                    <h2 class="text-2xl font-bold mb-2">${data.title}</h2>
                    <p class="text-gray-400 text-sm mb-4 flex-grow">${data.description}</p>
                    <ul class="space-y-2 text-gray-300 mb-6">
                      ${data.features.map(item => `<li><span class="accent-color mr-2">✓</span> ${item}</li>`).join('')}
                    </ul>
                    <div class="price-tag text-center p-4 rounded-lg mt-auto">
                        <p class="text-gray-400 line-through text-lg">Antes: $${data.old_price}</p>
                        <p class="text-4xl font-black accent-color">$${data.new_price} <span class="text-xl text-gray-300">MXN</span></p>
                    </div>
                </div>
                <div class="p-6 bg-black/30">
                    <a href="${data.button_link}" target="_blank" class="block text-center w-full bg-accent text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
                        ${data.button_text}
                    </a>
                    <p class="text-center text-xs text-gray-500 mt-3">${data.valid_until}</p>
                </div>
            </div>
          `;
          container.innerHTML += card;
        }
      }

      function parseFrontMatter(mdContent) {
        const regex = /^---\n([\s\S]+?)\n---/;
        const match = mdContent.match(regex);
        const yamlContent = match ? match[1] : "";
        const lines = yamlContent.split("\n");
        const data = {};
        let currentKey = null;

        lines.forEach(line => {
          if (line.startsWith("  - ")) {
            if (!data[currentKey]) data[currentKey] = [];
            data[currentKey].push(line.replace("  - ", "").trim());
          } else if (line.includes(":")) {
            const [key, ...rest] = line.split(":");
            currentKey = key.trim();
            data[currentKey] = rest.join(":").trim().replace(/^"|"$/g, "");
          }
        });

        return data;
      }

      loadPromotions();
    </script>
</body>
</html>
